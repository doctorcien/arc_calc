<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARC Raiders // Tactical Computer V2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --arc-red: #ff3333;
            --arc-bg: #0a0a0a;
            --arc-panel: #141414;
            --arc-text: #e0e0e0;
            --arc-dim: #666;
        }
        body {
            background-color: var(--arc-bg);
            color: var(--arc-text);
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: var(--arc-red);
            text-transform: uppercase;
            letter-spacing: 3px;
            border-bottom: 2px solid var(--arc-red);
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            justify-content: center;
        }
        .panel {
            background-color: var(--arc-panel);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .controls { flex: 1; min-width: 300px; }
        .display { flex: 2; min-width: 300px; }
        
        label {
            display: block;
            margin-top: 15px;
            color: var(--arc-red);
            font-weight: bold;
            font-size: 0.9rem;
        }
        select, input[type="range"] {
            width: 100%;
            background: #222;
            color: white;
            border: 1px solid #444;
            padding: 10px;
            margin-top: 5px;
            font-family: inherit;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-box {
            background: #1a1a1a;
            padding: 10px;
            text-align: center;
            border: 1px solid #333;
        }
        .stat-val { font-size: 1.2rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.7rem; color: var(--arc-dim); text-transform: uppercase; }
        
        #error-log {
            color: #ff9900;
            font-size: 0.8rem;
            margin-top: 10px;
            text-align: center;
            display: none; /* Se oculta si todo va bien */
        }
    </style>
</head>
<body>

    <h1>ARC Raiders // Tactical V2</h1>

    <div id="error-log"></div>

    <div class="container">
        <div class="panel controls">
            <h3 style="border-bottom:1px solid #333; padding-bottom:10px;">CONFIGURACI√ìN</h3>
            
            <label>ARMA</label>
            <select id="weaponSelect">
                <option>Cargando datos...</option>
            </select>

            <label>OBJETIVO</label>
            <select id="targetSelect">
                <option value="0.4,100">Raider Ligero (Armor 40%)</option>
                <option value="0.525,150" selected>Heavy Raider (Armor 52.5%)</option>
                <option value="0,90">Wasp Drone (Sin Armor)</option>
                <option value="0.525,100">Jugador PvP (Heavy Shield)</option>
            </select>

            <label>TU PUNTER√çA: <span id="acc-display">50%</span></label>
            <input type="range" id="accuracy" min="10" max="100" value="50" step="5">
            
            <label>MULTIPLICADOR</label>
            <select id="shotType">
                <option value="1">Cuerpo (1.0x)</option>
                <option value="2.5">Cabeza (2.5x)</option>
            </select>

            <div style="margin-top: 20px; padding: 10px; background: #222; border-left: 3px solid var(--arc-red);">
                <small style="color:#aaa;">CONSEJO:</small><br>
                <span id="tactical-advice">Calculando...</span>
            </div>
        </div>

        <div class="panel display">
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-val" id="res-bullets">--</span>
                    <span class="stat-label">Balas (Hits)</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="res-ttk" style="color: var(--arc-red);">--</span>
                    <span class="stat-label">Time To Kill</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="res-rpm">--</span>
                    <span class="stat-label">RPM</span>
                </div>
            </div>
            <canvas id="ttkChart"></canvas>
            <p id="chart-fallback" style="text-align:center; color:#555; display:none;">
                [GR√ÅFICA DESACTIVADA: Librer√≠a no carg√≥]
            </p>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS ---
        const weapons = [
            { name: "Ferro (Rifle)", dmg: 40, rpm: 12, pen: 0.4 },
            { name: "Rattler (AR)", dmg: 9, rpm: 500, pen: 0.2 },
            { name: "Kettle (AR Light)", dmg: 10, rpm: 535, pen: 0.0 },
            { name: "Stitcher (SMG)", dmg: 7, rpm: 675, pen: 0.0 },
            { name: "Anvil (Hand Cannon)", dmg: 40, rpm: 110, pen: 0.4 },
            { name: "Arpeggio (Burst)", dmg: 9.5, rpm: 350, pen: 0.2 },
            { name: "Il Toro (Shotgun)", dmg: 67.5, rpm: 45, pen: 0.1 },
            { name: "Burletta (Pistol)", dmg: 10, rpm: 400, pen: 0.0 },
            { name: "Renegade (Lever)", dmg: 35, rpm: 80, pen: 0.2 }
        ];

        let myChart = null;
        let chartEnabled = false;

        // --- SISTEMA DE INICIO SEGURO ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                initApp();
            } catch (e) {
                document.getElementById('error-log').innerText = "Error cr√≠tico: " + e.message;
                document.getElementById('error-log').style.display = 'block';
            }
        });

        function initApp() {
            // 1. Llenar Dropdown
            const wSelect = document.getElementById('weaponSelect');
            wSelect.innerHTML = ''; // Limpiar
            weapons.forEach((w, index) => {
                let opt = document.createElement('option');
                opt.value = index;
                opt.innerHTML = w.name;
                wSelect.appendChild(opt);
            });

            // 2. Conectar Eventos
            document.getElementById('weaponSelect').addEventListener('change', updateAnalysis);
            document.getElementById('targetSelect').addEventListener('change', updateAnalysis);
            document.getElementById('accuracy').addEventListener('input', updateAnalysis);
            document.getElementById('shotType').addEventListener('change', updateAnalysis);

            // 3. Intentar Iniciar Gr√°fica
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('ttkChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Curva de Riesgo (TTK)',
                            data: [],
                            borderColor: '#ff3333',
                            backgroundColor: 'rgba(255, 51, 51, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: { responsive: true, scales: { y: { min: 0 } } }
                });
                chartEnabled = true;
            } else {
                document.getElementById('ttkChart').style.display = 'none';
                document.getElementById('chart-fallback').style.display = 'block';
                document.getElementById('error-log').innerText = "Modo Texto: Chart.js no carg√≥ (¬øSin internet?)";
                document.getElementById('error-log').style.display = 'block';
            }

            // 4. Primera Ejecuci√≥n
            updateAnalysis();
        }

        // --- CEREBRO MATEM√ÅTICO ---
        function calculateTTK(weapon, armor, hp, acc, head) {
            let mitigation = Math.max(0, armor - weapon.pen);
            let dmg = weapon.dmg * head * (1 - mitigation);
            if (dmg <= 0) return 999; // Inmune
            
            let hitsNeeded = Math.ceil(hp / dmg);
            let shotsFired = Math.ceil(hitsNeeded / acc);
            let time = (shotsFired - 1) * (60 / weapon.rpm);
            return time < 0 ? 0 : time;
        }

        function updateAnalysis() {
            // Obtener datos
            const wIndex = document.getElementById('weaponSelect').value;
            const weapon = weapons[wIndex];
            const targetVal = document.getElementById('targetSelect').value.split(',');
            const tArmor = parseFloat(targetVal[0]);
            const tHp = parseFloat(targetVal[1]);
            const acc = parseInt(document.getElementById('accuracy').value) / 100;
            const head = parseFloat(document.getElementById('shotType').value);

            // UI
            document.getElementById('acc-display').innerText = (acc*100) + "%";
            document.getElementById('res-rpm').innerText = weapon.rpm;

            // Calcular
            let ttk = calculateTTK(weapon, tArmor, tHp, acc, head);
            
            // Balas (Display)
            let mit = Math.max(0, tArmor - weapon.pen);
            let dmgHit = weapon.dmg * head * (1 - mit);
            let hits = dmgHit > 0 ? Math.ceil(tHp / dmgHit) : "Invulnerable";

            document.getElementById('res-bullets').innerText = hits;
            document.getElementById('res-ttk').innerText = ttk === 999 ? "‚àû" : ttk.toFixed(2) + "s";

            // Consejos
            let adv = "Est√°ndar.";
            if (ttk > 3) adv = "‚ö†Ô∏è ¬°PELIGRO! TTK Demasiado alto.";
            else if (hits <= 2) adv = "üî• ¬°INSTAKILL!";
            document.getElementById('tactical-advice').innerText = adv;

            // Actualizar Gr√°fica (Solo si existe)
            if (chartEnabled && myChart) {
                const labels = [];
                const dataPoints = [];
                for(let i=10; i<=100; i+=10) {
                    labels.push(i + "%");
                    let t = calculateTTK(weapon, tArmor, tHp, i/100, head);
                    dataPoints.push(t > 10 ? 10 : t);
                }
                myChart.data.labels = labels;
                myChart.data.datasets[0].data = dataPoints;
                myChart.update();
            }
        }
    </script>
</body>
</html>
